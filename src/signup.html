<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Sign Up | MailNews</title>
<link rel="shortcut icon" href="./MailNews.png" type="image/png">
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2238125462513134"
      crossorigin="anonymous"
    ></script>
  </head>

  <body
    class="text-lg bg-slate-950 flex flex-wrap w-screen h-screen scroll-smooth overflow-x-hidden"
  >
    <nav
      class="fixed bg-slate-950 bg-opacity-90 lg:bg-opacity-45 top-0 left-0 w-full px-4 py-0 backdrop-blur-lg text-white z-20 flex items-center h-12 justify-between"
    >
      <div class="w-screen flex flex-wrap items-center justify-between p-2">
        <a href="/">
          <span
            class="self-center text-xl font-semibold whitespace-nowrap text-white"
            >MailNews</span
          >
        </a>
        <button
          id="navbar-solid-bg-btn"
          data-collapse-toggle="navbar-solid-bg-btn"
          type="button"
          class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
          aria-controls="navbar-solid-bg"
          aria-expanded="false"
        >
          <span class="sr-only">Open main menu</span>
          <svg
            class="w-5 h-5"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 17 14"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M1 1h15M1 7h15M1 13h15"
            />
          </svg>
        </button>
        <div
          id="mobile-menu"
          class="hidden top-10 lg:hidden w-screen fixed text-center left-0 z-50 rounded-br-lg rounded-bl-lg bg-slate-950 backdrop-blur-2xl duration-500"
        >
          <a href="#" class="block text-white py-2 px-4">Home</a>
          <a href="#" class="block text-white py-2 px-4">About</a>
          <a href="#" class="block text-white py-2 px-4">Services</a>
          <a href="#" class="block text-white py-2 px-4">Contact</a>
        </div>
        <div class="hidden w-full md:block md:w-auto" id="navbar-solid-bg">
          <ul
            class="flex flex-col font-medium mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent"
          >
            <li>
              <a
                href="/"
                class="block py-2 px-3 md:p-0 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-700 md:dark:text-blue-500 dark:bg-blue-600 md:dark:bg-transparent"
                aria-current="page"
                >Home</a
              >
            </li>
            <li>
              <a
                href="#"
                class="block py-2 px-3 md:p-0 text-white rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:dark:hover:bg-transparent"
                >Services</a
              >
            </li>
            <li>
              <a
                href="#"
                class="block py-2 px-3 md:p-0 text-white rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:dark:hover:bg-transparent"
                >Pricing</a
              >
            </li>
            <li>
              <a
                href="#"
                class="block py-2 px-3 md:p-0 text-white rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:dark:hover:bg-transparent"
                >Contact</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="w-20 h-20"></div>

    <div
      class="h-56 w-56 rounded-full blur-3xl -left-14 fixed top-0 bg-purple-700 -z-10"
    ></div>
    <div
      class="h-56 w-56 rounded-full blur-3xl -right-14 fixed bottom-0 bg-yellow-700 -z-10"
    ></div>

    <section
      class="w-screen flex items-center justify-center overflow-x-hidden align-middle m-auto pb-14"
    >
      <div
        class="bg-slate-800 bg-opacity-25 block backdrop-blur-lg w-5/6 lg:w-1/2 h-auto rounded-xl m-auto text-center px-5 py-6 text-white"
      >
        <h1 class="font-bold text-2xl">Subscribe To MailNews</h1>
        <div
          id="popup"
          class="bg-red-500 w-full h-auto relative p-3 mt-3 font-semibold rounded-md mb-3"
          style="display: none"
        >
          <p class="text-white">Email Already Registered With An Account</p>
          <div class="absolute top-0 right-0" onclick="toggleError('none')">
            <svg
              class="w-5 h-5 text-white"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="4"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </div>
        </div>

        <form
          action="javascript:submitForm()"
          method=""
          class="pt-8 gap-2 lg:px-3 lg:pt-4 lg:text-sm"
        >
          <input
            type="text"
            required
            name="name"
            class="border-slate-800 border-2 border-solid rounded-lg w-full p-2 outline-nonelg:p-2 mb-5 bg-slate-800 focus:bg-slate-700 duration-200 text-white font-semibold"
            placeholder="Name"
            onblur="checkNameFill(this)"
          />
          <input
            type="email"
            required
            name="email"
            class="border-slate-800 border-2 border-solid rounded-lg w-full p-2 outline-nonelg:p-2 bg-slate-800 focus:bg-slate-700 duration-200 mb-5 text-white font-semibold"
            placeholder="Email"
            onblur="validateEmail(this)"
          />
          <input
            type="text"
            required
            name="pass"
            class="border-slate-800 border-2 border-solid rounded-lg w-full p-2 outline-nonelg:p-2 bg-slate-800 focus:bg-slate-700 duration-200 mb-2 text-white font-semibold"
            placeholder="Create Password"
            onblur="validatePasswordPattern(this)"
          />
          <p
            class="mb-5 text-slate-300 font-light text-sm transition-all duration-200"
            id="password-hint"
          >
            Password Should Be Atleast 6 Characters And Contain Letters, Atleast
            1 Symbol and 1 Number
          </p>
          <input
            type="password"
            required
            name="conpass"
            class="border-slate-800 border-2 border-solid rounded-lg w-full p-2 outline-nonelg:p-2 bg-slate-800 focus:bg-slate-700 duration-200 mb-5 text-white font-semibold"
            placeholder="Confirm Password"
            onblur="validateSamePassword(this)"
          />

          <input type="number" hidden name="slot" />

          <h2 class="mt-1 lg:mt-0 font-bold text-xl text-left duration-300">
            Pick Your Interest
          </h2>
          <fieldset
            class="grid grid-cols-2 gap-2 mt-4 text-white text-lg align-middle justify-center lg:gap-1"
          >
            <div class="flex items-center">
              <input
                type="checkbox"
                id="World"
                name="World"
                value="World"
                onclick="javascript:this.parentElement.parentElement.parentElement.querySelector('h2').style.color = 'white';"
                class="mr-3 checked:accent-green-500"
              />
              <label for="option1">World</label>
            </div>
            <div class="flex items-center">
              <input
                type="checkbox"
                id="Science"
                name="Science"
                value="Science"
                onclick="javascript:this.parentElement.parentElement.parentElement.querySelector('h2').style.color = 'white';"
                class="mr-3 checked:accent-green-500"
              />
              <label for="option2">Science</label>
            </div>
            <div class="flex items-center">
              <input
                type="checkbox"
                id="Tech"
                name="Tech"
                value="Tech"
                onclick="javascript:this.parentElement.parentElement.parentElement.querySelector('h2').style.color = 'white';"
                class="mr-3 checked:accent-green-500"
              />
              <label for="option3">Tech</label>
            </div>
            <div class="flex items-center">
              <input
                type="checkbox"
                id="Business"
                name="Business"
                value="Business"
                onclick="javascript:this.parentElement.parentElement.parentElement.querySelector('h2').style.color = 'white';"
                class="mr-3 checked:accent-green-500"
              />
              <label for="option4">Business</label>
            </div>
            <div class="flex items-center">
              <input
                type="checkbox"
                id="Sports"
                name="Sports"
                value="Sports"
                onclick="javascript:this.parentElement.parentElement.parentElement.querySelector('h2').style.color = 'white';"
                class="mr-3 checked:accent-green-500 checked:bg-green-600"
              />
              <label for="option5">Sports</label>
            </div>
            <div class="flex items-center w-full overflow-clip break-words">
              <input
                type="checkbox"
                id="Entertainment"
                name="Entertainment"
                value="Entertainment"
                onclick="javascript:this.parentElement.parentElement.parentElement.querySelector('h2').style.color = 'white';"
                class="mr-3 checked:accent-green-500"
              />
              <label for="option6">Entertainment</label>
            </div>
          </fieldset>

          <button
            type="submit"
            disabled
            class="!bg-slate-700 text-white rounded-full px-12 py-3 lg:px-6 lg:py-2 mt-5 font-semibold text-lg disabled:bg-opacity-70 disabled:text-gray-400"
          >
            Subscribe
          </button>
        </form>
        <p class="mt-4">
          Already Have An Account ?
          <span class="text-fuchsia-500 font-semibold"
            ><a href="/signin">Sign-In</a></span
          >
        </p>
      </div>
    </section>
  </body>
  <script>
    var popup = document.querySelector("#popup");
    function toggleError(visibility) {
      popup.style.display = visibility;
    }

    function getSlot() {
      var d = new Date();
      d.setHours(7, 0, 0, 0);
      return parseInt(d.getUTCHours()*2 + parseInt(d.getUTCMinutes() / 30));
    }

    document.querySelector('input[name="slot"]').value = getSlot();
    function checkNameFill(ele) {
      if (ele.value) {
        (ele.style.border = "2px solid rgb(34, 197, 94)"),
          document
            .querySelector("button[type='submit']")
            .removeAttribute("disabled");
      } else {
        ele.style.border = "2px solid red";
        document
          .querySelector("button[type='submit']")
          .setAttribute("disabled", "disabled");
      }
    }
    function validateEmail(ele) {
      if (/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(ele.value)) {
        (ele.style.border = "2px solid rgb(34, 197, 94)"),
          document
            .querySelector("button[type='submit']")
            .removeAttribute("disabled");
      } else {
        (ele.style.border = "2px solid red"),
          (ele.value = ""),
          ele.setAttribute("placeholder", "Enter a Valid E-Mail"),
          document
            .querySelector("button[type='submit']")
            .setAttribute("disabled", "disabled");
      }
    }
   
    function validatePasswordPattern(ele) {
      if (
        /(?=^.*[A-Za-z])(?=^.*\d)(?=^.*[!@#$%^&*+.-])^.+$/.test(ele.value) &&
        ele.value.length >= 6
      ) {
        (ele.style.border = "2px solid rgb(34, 197, 94)"),
          document
            .querySelector("button[type='submit']")
            .removeAttribute("disabled");
      } else {
        (ele.style.border = "2px solid red"),
          document
            .querySelector("button[type='submit']")
            .setAttribute("disabled", "disabled");
        validateSamePassword(ele.form.conpass);
      }
    }

   
    function validateSamePassword(ele) {
      if (ele.value == ele.form.pass.value && ele.value) {
        ele.style.border = "2px solid rgb(34, 197, 94)";
        document
          .querySelector("button[type='submit']")
          .removeAttribute("disabled");
      } else {
        (ele.style.border = "2px solid red"),
          document
            .querySelector("button[type='submit']")
            .removeAttribute("disabled");
        (ele.vlaue = ""),
          ele.value
            ? ele.setAttribute("placeholder", "Passwords Should Match")
            : null,
          document
            .querySelector("button[type='submit']")
            .setAttribute("disabled", "disabled");
      }
    }

    function submitForm() {
      var form = document.forms[0];
      var data = new FormData(form);
      if (
        !Array.from(form.querySelectorAll("input[type='checkbox']:checked"))
          .length
      ) {
        form.querySelector("h2").style.color = "red";
        return;
      }
      var formData = new URLSearchParams();
      data.forEach((value, key) => {
        formData.append(key, value);
      });
      formData.append(
        "topics",
        Array.from(form.querySelectorAll("input[type='checkbox']:checked"))
          .map((ele) => ele.value)
          .join(",")
      );
      document
        .querySelector("button[type='submit']")
        .setAttribute("disabled", "disabled");
      document.querySelector("button[type='submit']").innerHTML = `
      <svg class="animate-spin  h-7 w-7 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-50" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path  fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>`;
      fetch("/subscribe", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: formData.toString(), // Convert to URL-encoded string
      }).then((res) => {
        if (res.status == 200) {
          window.location.href = "/verify";
        } else if (res.status == 409) {
          toggleError("block");
          popup.textContent = "Email Already Registered With An Account";
          document
            .querySelector("button[type='submit']")
            .removeAttribute("disabled");
          document.querySelector(
            "button[type='submit']"
          ).innerHTML = `Subscribe`;
        } else {
          document
            .querySelector("button[type='submit']")
            .removeAttribute("disabled");
          document.querySelector(
            "button[type='submit']"
          ).innerHTML = `Subscribe`;
        }
      });
    }
  </script>
</html>
